--search by author
SELECT b.BOOK_ID, b.TITLE, a.NAME AS AUTHOR
FROM BOOK b
JOIN BOOK_AUTHOR ba ON b.BOOK_ID = ba.BOOK_ID
JOIN AUTHOR a ON ba.AUTHOR_ID = a.AUTHOR_ID 
WHERE a.NAME LIKE '%Gospodinov%';

--search by genre
SELECT b.BOOK_ID, b.TITLE, g.NAME AS GENRE, p.NAME AS PUBLISHER
FROM BOOK b
JOIN GENRE g ON b.GENRE_ID = g.GENRE_ID
JOIN PUBLISHER p ON b.PUBLISHER_ID = p.PUBLISHER_ID
WHERE g.NAME LIKE '%Fantasy%';

--search by publisher
SELECT b.BOOK_ID, b.TITLE, p.NAME AS PUBLISHER
FROM BOOK b
JOIN PUBLISHER p ON b.PUBLISHER_ID = p.PUBLISHER_ID
WHERE p.NAME LIKE '%Bard%';

--earning for a period of time
SELECT e.EMPLOYEE_ID, e.NAME as EMPLOYEE, SUM(o.PRICE) AS TOTAL_REVENUE
FROM ORDERS o
JOIN EMPLOYEE e ON o.EMPLOYEE_ID = e.EMPLOYEE_ID
WHERE o.ORDER_DATE BETWEEN TO_DATE('2025-01-01','YYYY-MM-DD') AND TO_DATE('2025-12-31','YYYY-MM-DD')
GROUP BY e.EMPLOYEE_ID, e.NAME
ORDER BY TOTAL_REVENUE DESC;

--top 5 bestselling books for a period of time
SELECT *
FROM (
  SELECT b.BOOK_ID, b.TITLE,a.NAME AS AUTHOR_NAME, SUM(ob.QUANTITY) AS TOTAL_SOLD
  FROM ORDERED_BOOKS ob 
  JOIN BOOK b ON ob.BOOK_ID = b.BOOK_ID
  JOIN ORDERS o ON ob.ORDER_ID = o.ORDER_ID
  JOIN BOOK_AUTHOR ba ON b.BOOK_ID = ba.BOOK_ID
  JOIN AUTHOR a ON ba.AUTHOR_ID = a.AUTHOR_ID
  WHERE o.ORDER_DATE BETWEEN TO_DATE('2025-01-01','YYYY-MM-DD')AND TO_DATE('2025-12-31','YYYY-MM-DD')
  GROUP BY b.BOOK_ID, b.TITLE, a.NAME
  ORDER BY TOTAL_SOLD DESC
)
WHERE ROWNUM <= 5;

--books sold, ordered by sales quantity
SELECT b.BOOK_ID, b.TITLE, a.NAME AS AUTHOR,p.NAME AS PUBLISHER, SUM(ob.QUANTITY) AS TOTAL_SOLD
FROM ORDERED_BOOKS ob
JOIN BOOK b ON ob.BOOK_ID = b.BOOK_ID
JOIN PUBLISHER p ON b.PUBLISHER_ID = p.PUBLISHER_ID
JOIN BOOK_AUTHOR ba ON b.BOOK_ID = ba.BOOK_ID
JOIN AUTHOR a ON ba.AUTHOR_ID = a.AUTHOR_ID
GROUP BY b.BOOK_ID, b.TITLE, a.NAME, p.NAME
ORDER BY TOTAL_SOLD DESC;

--top 3 authors with bestselling books
SELECT *
FROM (
  SELECT a.AUTHOR_ID, a.NAME AS AUTHOR, SUM(ob.QUANTITY) AS TOTAL_SOLD
  FROM ORDERED_BOOKS ob 
  JOIN BOOK b ON ob.BOOK_ID = b.BOOK_ID
  JOIN BOOK_AUTHOR ba ON b.BOOK_ID=ba.BOOK_ID
  JOIN AUTHOR a ON ba.AUTHOR_ID=a.AUTHOR_ID
  GROUP BY a.AUTHOR_ID, a.NAME
  ORDER BY TOTAL_SOLD DESC
)
WHERE ROWNUM <= 3;

--last 5 orders, ordered by date
SELECT *
FROM (
  SELECT o.ORDER_ID, c.CUSTOMER_ID, c.NAME AS CUSTOMER, o.ORDER_DATE, o.PRICE 
  FROM ORDERS o
  JOIN CUSTOMER c ON o.CUSTOMER_ID=c.CUSTOMER_ID
  ORDER BY o.ORDER_DATE DESC
)
WHERE ROWNUM <= 5;